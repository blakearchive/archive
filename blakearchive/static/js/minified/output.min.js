directoryPrefix="/blake",angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition","$q",function(a,b,c,d){}]).directive("carousel",[function(){return{}}]),angular.module("blake",["ngRoute","ui.bootstrap",angularDragula(angular)]).config(["$routeProvider","$locationProvider",function(a,b){a.when(directoryPrefix+"/",{templateUrl:directoryPrefix+"/static/html/home.html",controller:"HomeController"}),a.when(directoryPrefix+"/object/:objectId",{templateUrl:directoryPrefix+"/static/html/object.html",controller:"ObjectController"}),a.when(directoryPrefix+"/copy/:copyId",{templateUrl:directoryPrefix+"/static/html/copy.html",controller:"CopyController"}),a.when(directoryPrefix+"/copy/:copyId/:objectId",{templateUrl:directoryPrefix+"/static/html/copy.html",controller:"CopyController"}),a.when(directoryPrefix+"/work/:workId",{templateUrl:directoryPrefix+"/static/html/work.html",controller:"WorkController"}),a.when(directoryPrefix+"/compare/",{templateUrl:directoryPrefix+"/static/html/compare.html"}),a.when(directoryPrefix+"/search/",{templateUrl:directoryPrefix+"/static/html/search.html",controller:"SearchController"}),a.otherwise({redirectTo:directoryPrefix+"/"}),b.html5Mode(!0)}]),angular.module("blake").factory("GenericService",function(){return function(a){return{create:function(b){var c,d;if(b.length)for(d=[],c=0;c<b.length;c++)d.push(a(b[c]));else d=a(b);return d}}}}),angular.module("blake").factory("BlakeObject",["GenericService",function(a){var b=function(a){var b=angular.copy(a);return b.illustration_description=angular.fromJson(a.illustration_description),b.characteristics=angular.fromJson(a.characteristics),b.text=angular.fromJson(a.text),b};return a(b)}]),angular.module("blake").factory("BlakeCopy",["BlakeObject","GenericService",function(a,b){var c=function(b){var c,d=angular.copy(b);if(d.header=angular.fromJson(b.header),d.source=angular.fromJson(b.source),b.objects)for(c=0;c<b.objects.length;c++)d.objects.push(a.create(b.objects[c]));return d};return b(c)}]),angular.module("blake").factory("BlakeWork",["BlakeCopy","GenericService",function(a,b){var c=function(b){var c,d=angular.copy(b);if(b.copies)for(c=0;c<b.copies.length;c++)d.copies.push(a.create(b.copies[c]));return d};return b(c)}]),angular.module("blake").factory("BlakeFeaturedWork",["GenericService",function(a){var b=function(a){return angular.copy(a)};return a(b)}]),angular.module("blake").factory("BlakeDataService",["$http","$q","$rootScope","BlakeWork","BlakeCopy","BlakeObject","BlakeFeaturedWork",function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=[],G=!1,H=!1,I=!1;return m=function(c){var d=directoryPrefix+"/api/query_objects";return b(function(b,e){a.post(d,c).success(function(a){b(a)}).error(function(a,b){e(a,b)})})},n=function(c){var d=directoryPrefix+"/api/object/"+c;return b(function(b,c){a.get(d).success(function(a){b(f.create(a))}).error(function(a,b){c(a,b)})})},E=function(){H=!1,I=!1,G=!1,c.$broadcast("objectSelectionChange")},o=function(c){var d=directoryPrefix+"/api/object/"+c+"/objects_with_same_motif";return b(function(b,c){a.get(d).success(function(a){a.results.length&&(G=!0),b(f.create(a.results))}).error(function(a,b){c(a,b)})})},p=function(c){var d=directoryPrefix+"/api/object/"+c+"/objects_from_same_matrix";return b(function(b,c){a.get(d).success(function(a){a.results.length&&(H=!0),b(f.create(a.results))}).error(function(a,b){c(a,b)})})},q=function(c){var d=directoryPrefix+"/api/object/"+c+"/objects_from_same_production_sequence";return b(function(b,c){a.get(d).success(function(a){a.results.length&&(I=!0),b(f.create(a.results))}).error(function(a,b){c(a,b)})})},r=function(c){var d=directoryPrefix+"/api/copy/"+c;return b(function(b,c){a.get(d).success(function(a){b(e.create(a))}).error(function(a,b){c(a,b)})})},s=function(c){var d=directoryPrefix+"/api/copy/"+c+"/objects";return b(function(b,c){a.get(d).success(function(a){b(f.create(a.results))}).error(function(a,b){c(a,b)})})},t=function(c){var e=directoryPrefix+"/api/work/"+c;return b(function(b,c){a.get(e).success(function(a){b(d.create(a))}).error(function(a,b){c(a,b)})})},u=function(){var c=directoryPrefix+"/api/work/";return b(function(b,e){a.get(c).success(function(a){b(d.create(a.results))}).error(function(a,b){e(a,b)})})},v=function(c){var d=directoryPrefix+"/api/work/"+c+"/copies";return b(function(b,c){a.get(d).success(function(a){b(e.create(a.results))}).error(function(a,b){c(a,b)})})},w=function(){var c=directoryPrefix+"/api/featured_work/";return b(function(b,d){a.get(c).success(function(a){b(g.create(a.results))}).error(function(a,b){d(a,b)})})},x=function(a){return t(a).then(function(b){h=b,c.$broadcast("workSelectionChange",b),v(a).then(function(a){k=a,c.$broadcast("workSelectionCopiesChange")})})},y=function(a,b){return r(a).then(function(d){i=d,c.$broadcast("copySelectionChange",d),s(a).then(function(a){l=a,b?a.forEach(function(a){a.object_id==b&&(j=a)}):j=a[0],c.$broadcast("copySelectionObjectsChange"),E()})})},z=function(a){return n(a).then(function(a){j=a,E()})},A=function(a){var b,d=!1;for(b=F.length;b--;)if(F[b].object_id==a.object_id){d=!0;break}d||(F.push(a),c.$broadcast("comparisonObjectsChange"))},B=function(a){var b;for(b=F.length;b--;)if(F[b].object_id==a.object_id){F.splice(b,1),c.$broadcast("comparisonObjectsChange");break}},C=function(){F=[],c.$broadcast("comparisonObjectsChange")},D=function(a){for(var b=F.length;b--;)if(F[b].object_id==a.object_id)return!0;return!1},{queryObjects:m,getObject:n,getObjectsWithSameMotif:o,hasObjectsWithSameMotif:function(){return G},getObjectsFromSameMatrix:p,hasObjectsFromSameMatrix:function(){return H},getObjectsFromSameProductionSequence:q,hasObjectsFromSameProductionSequence:function(){return I},getCopy:r,getObjectsForCopy:s,getWork:t,getWorks:u,getCopiesForWork:v,getFeaturedWorks:w,setSelectedWork:x,setSelectedCopy:y,setSelectedObject:z,getSelectedWork:function(){return h},getSelectedCopy:function(){return i},getSelectedObject:function(){return j},getSelectedWorkCopies:function(){return k},getSelectedCopyObjects:function(){return l},addComparisonObject:A,removeComparisonObject:B,clearComparisonObjects:C,getComparisonObjects:function(){return F},isComparisonObject:D}}]),angular.module("blake").factory("MockBlakeDataService",["$http","$q","BlakeWork","BlakeCopy","BlakeObject","BlakeFeaturedWork",function(a,b,c,d,e,f){var g=function(){return b(function(b,c){a.get(directoryPrefix+"/static/json/objects.json").success(function(a){b(e.create(a))}).error(function(a,b){c(a,b)})})},h=function(){return b(function(b,c){a.get(directoryPrefix+"/static/json/objects.json").success(function(a){b(e.create(a[0]))}).error(function(a,b){c(a,b)})})},i=function(){return b(function(b,c){a.get(directoryPrefix+"/static/json/copies.json").success(function(a){b(d.create(a))}).error(function(a,b){c(a,b)})})},j=function(){return b(function(b,c){a.get(directoryPrefix+"/static/json/copies.json").success(function(a){b(d.create(a[0]))}).error(function(a,b){c(a,b)})})},k=function(){return b(function(b,d){a.get(directoryPrefix+"/static/json/works.json").success(function(a){b(c.create(a))}).error(function(a,b){d(a,b)})})},l=function(){return b(function(b,d){a.get(directoryPrefix+"/static/json/works.json").success(function(a){b(c.create(a[0]))}).error(function(a,b){d(a,b)})})},m=function(){return b(function(b,c){a.get(directoryPrefix+"/static/json/featured_works.json").success(function(a){b(f.create(a))}).error(function(a,b){c(a,b)})})};return{query:function(a){return g()},getObject:function(a){return h()},getObjectsWithSameMotif:function(a){return g()},getObjectsFromSameMatrix:function(a){return g()},getObjectsFromSameProductionSequence:function(a){return g()},getCopy:function(a){return j()},getObjectsForCopy:function(a){return g()},getWork:function(a){return l()},getWorks:function(){return k()},getCopiesForWork:function(a){return i()},getFeaturedWorks:function(){return m()}}}]),angular.module("blake").factory("UtilityServices",function(){var a=function(){var a={};return a.waitForIdle=function(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}},a};return{responseChange:a}}),angular.module("blake").controller("HomeController",["$rootScope","$scope","BlakeDataService",function(a,b,c){a.showSubMenu=0,c.getFeaturedWorks().then(function(a){b.featured_works=a})}]),angular.module("blake").controller("WorkController",["$scope","$routeParams","BlakeDataService",function(a,b,c){c.setSelectedWork(b.workId)}]),angular.module("blake").controller("ObjectController",["$scope","$routeParams","BlakeDataService",function(a,b,c){c.setSelectedWork(b.objectId)}]),angular.module("blake").controller("CopyController",["$scope","$routeParams","BlakeDataService",function(a,b,c){c.setSelectedCopy(b.copyId,b.objectId)}]),angular.module("blake").controller("SearchController",["$rootScope","$scope","$location","$routeParams","BlakeDataService",function(a,b,c,d,e){a.showSubMenu=0,b.search=function(){e.queryObjects(b.searchConfig).then(function(a){b.results=a})},b.loadSearchPage=function(){c.url(directoryPrefix+"/search?search="+encodeURIComponent(b.searchText))},d.search&&(b.searchConfig={searchString:d.search},b.search()),b.showWorks=!0,b.showCopies=!0,b.showObjects=!0}]),function(a){"use strict";a(function(){function b(){var b=a(window).height()-220;a("#object-view .carousel .featured-object img").css("height",b+"px")}function c(){var b=a(window).scrollTop();a("#scroll-wrapper1").css("margin-top",-90-.2*b+"px"),a("#scroll-wrapper2").css("margin-top",-20-.4*b+"px"),a("#scroll-wrapper3").css("margin-top",-90-.14*b+"px"),a("#scroll-wrapper4").css("margin-top",-20-.4*b+"px"),a("#scroll-wrapper5").css("margin-top",-90-.5*b+"px"),a("#scroll-wrapper6").css("margin-top",-20-.3*b+"px")}var d={};d.waitForIdle=function(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}},a(window).on("resize",d.waitForIdle(function(){if(a("nav.navbar ul.navbar-nav li.dropdown").hasClass("open")){var b=a(window).width(),c=a("nav.navbar ul.navbar-nav li.dropdown.open").offset().left;a("nav.navbar ul.navbar-nav li.dropdown.open").find("ul.dropdown-menu").css({width:b+"px",left:"-"+c+"px"})}},100));var e=a("button.collapse-archive"),f=a("nav.navbar");"true"!==localStorage.getItem("archive_menu_dismissed")?(e.addClass("menu-closed").removeClass("menu-open"),f.addClass("menu-closed").removeClass("menu-open")):(f.addClass("menu-open").removeClass("menu-closed"),e.addClass("menu-open").removeClass("menu-closed")),e.on("click",function(){f.hasClass("menu-open")?(f.removeClass("menu-open").addClass("menu-closed"),e.removeClass("menu-open").addClass("menu-closed"),localStorage.setItem("archive_menu_dismissed","false")):(f.addClass("menu-open").removeClass("menu-closed"),e.addClass("menu-open").removeClass("menu-closed"),localStorage.setItem("archive_menu_dismissed","true"))}),a("#object-view .carousel").length&&(b(),a(window).on("resize",d.waitForIdle(function(){b()},100))),a(".scrollbar").scroller({customClass:"advanced",trackMargin:10,horizontal:!0}),a(window).on("resize",d.waitForIdle(function(){a(".scrollbar").scroller("reset")},100)),a(".back-top").length&&(a(".back-top").on("click",function(){a("html, body").animate({scrollTop:0},"slow")}),a(window).on("scroll",function(){var b=a(window).scrollTop();b>=50?a(".back-top").addClass("scrolling"):a(".back-top").removeClass("scrolling")})),c(),a("body.home").length&&a(window).bind("scroll",function(a){c()}),a("body.home").length&&a(function(){a("img.lazy-load").lazyload({threshold:100})})})}(this.jQuery),angular.module("blake").directive("objectsForCopy",function(){return{restrict:"E",scope:!0,templateUrl:"/blake/static/directives/objects-for-copy/template.html",controller:"ObjectsForCopyController"}}),angular.module("blake").controller("ObjectsForCopyController",["$scope","BlakeDataService",function(a,b){a.$watch(b.getSelectedCopy,function(c){c&&(a.copy=c,b.getObjectsForCopy(c.bad_id).then(function(b){a.objects=b}))})}]),angular.module("blake").directive("copiesForWork",function(){return{restrict:"E",templateUrl:"/blake/static/directives/copies-for-work/template.html",controller:"CopiesForWorkController"}}),angular.module("blake").controller("CopiesForWorkController",["$scope","BlakeDataService",function(a,b){a.getCopyFirstObject=function(b){function c(a){switch(a){case"comb":return"com";case"comdes":return"com";case"comeng":return"com";case"spb":return"sp";case"spdes":return"sp";case"speng":return"sp";case"cprint":return"cpd";case"mono":return"wd";case"paint":return"pt";case"pen":return"pid";case"penink":return"pid";case"penc":return"pid";case"wc":return"wc";case"ms":return"ms";case"ltr":return"lt";case"te":return"typ";default:return!1}}return a.work?"illbk"==a.work.medium?"http://www.blakearchive.org/blake/images/"+b.bad_id+".p1.100.jpg":"http://www.blakearchive.org/blake/images/"+b.bad_id+".1."+c(a.work.medium)+".100.jpg":void 0},a.$on("workSelectionChange",function(){a.work=b.getSelectedWork()}),a.$on("workSelectionCopiesChange",function(){var c=b.getSelectedWorkCopies();c.sort(function(a,b){return a.source.objdescid.compdate["@value"]-b.source.objdescid.compdate["@value"]}),a.copies=c})}]),angular.module("blake").directive("viewSubMenu",function(){return{restrict:"E",scope:!0,templateUrl:"/blake/static/directives/view-sub-menu/template.html",controller:"viewSubMenuController"}}),angular.module("blake").controller("viewSubMenuController",["$scope",function(a){}]),angular.module("blake").directive("navigationMenu",function(){function a(a,b,c){var d=function(a){switch(a){case"illbk":return"illuminated_books";case"comb":return"book_illustration:designed_engraved";case"comdes":return"book_illustration:designed";case"comeng":return"book_illustration:engraved";case"spb":return"prints:designed_engraved";case"spdes":return"prints:designed";case"speng":return"prints:engraved";case"cprint":return"prints:drawings";case"mono":return"drawings_paintings:monochrome";case"paint":return"drawings_paintings:paintings";case"pen":case"penink":return"drawings_paintings:pen";case"penc":return"drawings_paintings:pencil";case"wc":return"drawings_paintings:wc";case"ms":return"manuscripts_typo:manuscripts";case"ltr":return"manuscripts_typo:letters";case"te":return"manuscripts_typo:typographic";default:return!1}};a.organizeMenus=function(b){if(b){b.sort(function(a,b){return a.composition_date-b.composition_date});var c={illuminated_books:[],book_illustration:[{designed_engraved:[],designed:[],engraved:[]}],prints:[{designed_engraved:[],designed:[],engraved:[],drawings:[]}],drawings_paintings:[{pencil:[],pen:[],monochrome:[],wc:[],paintings:[]}],manuscripts_typo:[{manuscripts:[],letters:[],typographic:[]}]};b.forEach(function(a){var b,e=d(a.medium);e&&(b=e.split(/:/),(void 0!==c[b[0]]||void 0!==c[b[0]][0][b[1]])&&(1===b.length?c[b[0]].push(a):c[b[0]][0][b[1]].push(a)))}),a.menu_lists=c}}}return{restrict:"E",link:a,controller:"MenuController",templateUrl:"/blake/static/directives/menu/template.html"}}),angular.module("blake").controller("MenuController",["$scope","BlakeDataService",function(a,b){$("nav.navbar ul.navbar-nav > li.dropdown").click(function(){var a=$(window).width(),b=$(this).offset().left;$(this).find("ul.dropdown-menu").css({width:a+"px",left:"-"+b+"px"})}),b.getWorks().then(function(b){a.organizeMenus(b)})}]),angular.module("blake").directive("copyInformation",function(){return{restrict:"E",templateUrl:"/blake/static/directives/copy-information/template.html",controller:"CopyInformationController"}}),angular.module("blake").controller("CopyInformationController",["$scope","BlakeDataService",function(a,b){a.copy=b.getSelectedCopy(),a.$on("copySelectionChange",function(){a.copy=b.getSelectedCopy()}),a.getOriginationRole=function(a){if(a){if(a.join){var b=[];return a.forEach(function(a){b.push(a["#text"])}),b.join(" ")}return a["#text"]}}}]),angular.module("blake").directive("objectViewer",function(){return{restrict:"E",templateUrl:"/blake/static/directives/object-viewer/template.html",controller:"ObjectViewerController"}}),angular.module("blake").controller("ObjectViewerController",["$rootScope","$scope","BlakeDataService",function(a,b,c){a.showSubMenu=1,b.BlakeDataService=c,b.getPreviousNextObjects=function(){if(b.objects&&b.objects.length)for(var a=b.objects.length;a--;)if(b.objects[a].object_id==b.obj.object_id){0>a-1?b.previousObject=b.objects[b.objects.length-1]:b.previousObject=b.objects[a-1],a+1>=b.objects.length?b.nextObject=b.objects[0]:b.nextObject=b.objects[a+1];break}},b.getObjLines=function(){var a=[];return b.obj&&b.obj.text&&b.obj.text.lg&&b.obj.text.lg.length&&b.obj.text.lg.forEach(function(b){b.l.length?b.l.forEach(function(b){a.push(b["#text"])}):a.push(b.l["#text"])}),a},b.toggleTray=function(){function a(){var a=d.height(),b=$(".panel-group .panel-default").length,c=a-47*b;$(".panel-group").css("min-height",a+"px"),$(".panel-group .panel-body").css("max-height",c+"px")}var b=$("#object-container");b.hasClass("tray-closed")?(b.removeClass("tray-closed").addClass("tray-open"),setTimeout(function(){$(".scrollbar").scroller("reset")},300),$(".scrollbar").scroller("reset")):(b.removeClass("tray-open").addClass("tray-closed"),$(".scrollbar").scroller("reset"),setTimeout(function(){$(".scrollbar").scroller("reset")},300));var c={};c.waitForIdle=function(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}};var d=$("#object-view");$("#object-detail-tray").length&&(a(),d.resize(c.waitForIdle(function(){a()},100)))},b.copy=c.getSelectedCopy(),b.objects=c.getSelectedCopyObjects(),b.obj=c.getSelectedObject(),b.getPreviousNextObjects(),b.$on("copySelectionChange",function(){b.copy=c.getSelectedCopy()}),b.$on("copySelectionObjectsChange",function(){b.objects=c.getSelectedCopyObjects()}),b.$on("objectSelectionChange",function(){b.obj=c.getSelectedObject(),b.getPreviousNextObjects()})}]),angular.module("blake").directive("objectsFromSameMatrix",function(){return{restrict:"E",scope:!0,templateUrl:"/blake/static/directives/objects-from-same-matrix/template.html",controller:"ObjectsFromSameMatrixController"}}),angular.module("blake").controller("ObjectsFromSameMatrixController",["$scope","BlakeDataService",function(a,b){a.BlakeDataService=b,a.$on("objectSelectionChange",function(){var c=b.getSelectedObject();c&&(a.item=c,b.getObjectsFromSameMatrix(c.object_id).then(function(b){a.objects=b}))}),a.selectAll=function(){for(var c=a.objects.length;c--;)b.addComparisonObject(a.objects[c])}}]),angular.module("blake").directive("objectsFromSameProductionSequence",function(){return{restrict:"E",scope:!0,templateUrl:"/blake/static/directives/objects-from-same-production-sequence/template.html",controller:"ObjectsFromSameProductionSequenceController"}}),angular.module("blake").controller("ObjectsFromSameProductionSequenceController",["$scope","BlakeDataService",function(a,b){a.BlakeDataService=b,a.$on("objectSelectionChange",function(){var c=b.getSelectedObject();c&&(a.item=c,b.getObjectsFromSameProductionSequence(c.object_id).then(function(b){a.objects=b}))})}]),angular.module("blake").directive("objectsWithSameMotif",function(){return{restrict:"E",scope:!0,templateUrl:"/blake/static/directives/objects-with-same-motif/template.html",controller:"ObjectsWithSameMotifController"}}),angular.module("blake").controller("ObjectsWithSameMotifController",["$scope","BlakeDataService",function(a,b){a.BlakeDataService=b,a.$on("objectSelectionChange",function(){var c=b.getSelectedObject();c&&(a.item=c,b.getObjectsWithSameMotif(c.object_id).then(function(b){a.objects=b}))})}]),angular.module("blake").directive("objectCompare",function(){return{restrict:"E",scope:!0,templateUrl:"/blake/static/directives/object-compare/template.html",controller:"ObjectCompareController"}}),angular.module("blake").controller("ObjectCompareController",["$scope","BlakeDataService","UtilityServices",function(a,b,c){function d(){var a=0;$("#object-view #compare .item").each(function(){a+=Number($(this).width())}),$("#object-view #compare .compare-inner").css("width",a+10+"px")}function e(){var a=$(window).height()-370;$("#object-view #compare .featured-object img").css("height",a+"px")}a.BlakeDataService=b,a.getObjLines=function(){var b=[];return a.obj&&a.obj.text.lg.length&&a.obj.text.lg.forEach(function(a){a.l.length?a.l.forEach(function(a){b.push(a["#text"])}):b.push(a.l["#text"])}),b},a.toggleTray=function(){var a=$("#object-container");a.hasClass("tray-closed")?(a.removeClass("tray-closed").addClass("tray-open"),setTimeout(function(){$(".scrollbar").scroller("reset")},300),$(".scrollbar").scroller("reset")):(a.removeClass("tray-open").addClass("tray-closed"),$(".scrollbar").scroller("reset"),setTimeout(function(){$(".scrollbar").scroller("reset")},300))},a.comparisonObjects=b.getComparisonObjects(),a.obj=b.getSelectedObject(),a.$on("comparisonObjectsChange",function(){a.comparisonObjects=b.getComparisonObjects()}),a.$on("objectSelectionChange",function(){a.obj=b.getSelectedObject()});var f=c.responseChange();angular.element(document).ready(function(){$("#home").removeClass("main"),d(),e()}),$(window).on("resize",f.waitForIdle(function(){d()},100)),$(window).on("resize",f.waitForIdle(function(){e()},100))}]);
//# sourceMappingURL=output.min.js.map